<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>登入系統</title>
  <link rel="stylesheet" href="assets/css/styles.css">
</head>
<body>

<div class="container">
  <h2>登入</h2>

  <form id="loginForm">
    <label>帳號
      <input id="username" required>
    </label>

    <label>密碼
      <input id="password" type="password" required>
    </label>

    <button class="btn">登入</button>
  </form>
</div>

<script type="module">
import { apiFetch } from "./assets/js/api.js";

document.getElementById("loginForm").onsubmit = async e => {
  e.preventDefault();

  const username = document.getElementById("username").value;
  const password = document.getElementById("password").value;

  try {
    const res = await apiFetch("/login", {
      method: "POST",
      body: JSON.stringify({ username, password })
    });

    // 儲存 token
    if (res.role === "admin") {
      localStorage.setItem("token", "admin");
    } else {
      localStorage.setItem("token", res.id);
    }

    location.href = "patients/patients.html";

  } catch (err) {
    alert("登入失敗：" + err.message);
  }
};
  if (res.role === "admin") {
  localStorage.setItem("token", "admin");
  location.href = "admin/admin.html";
} else {
  localStorage.setItem("token", res.id);
  location.href = "patients/patients.html";
}
</script>

</body>
</html>
